const popularCourses = [
    {
        "courseIndex": 1,
        "courseName": "Giải đề PE Prj301 | Fall 2023 | 9.5+",
        "courseImage": "./img/pe_prj_fall_2023.jpg",
        "courseIntro": "https://www.youtube.com/embed/M62l1xA5Eu8",
        "courseType": "Sell",
        "courseStudents": 8.750,
        "courseRate": 4.8,
        "coursePrice": "Free",
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Giải đề PE Prj301 - 2023",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Giải đề PE Prj301 | Fall 2023 | 9.5+",
                        "lengthVideo": 89.5,
                        "linkVideo": "pEbsJdSFTh8",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            },
            {
                "chapterIndex": 1,
                "chapterTitle": "Giải đề PE Prj301 - 2024 ",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Giải đề PE Prj301 | Spring 2024 BL5 | Java servlet",
                        "lengthVideo": 74.43,
                        "linkVideo": "ndqm3JrRTOI",
                        "learnedVideo": false,
                        "learnedLength": -1
                    },
                    {
                        "indexVideo": 1,
                        "nameVideo": "Giải đề PE Prj301 | Summer 2024 | Q1",
                        "lengthVideo": 20.85,
                        "linkVideo": "y5GxN1Qhvgs",
                        "learnedVideo": false,
                        "learnedLength": -1
                    },
                    {
                        "indexVideo": 2,
                        "nameVideo": "Giải đề PE Prj301 | Summer 2024 | Q2",
                        "lengthVideo": 28.52,
                        "linkVideo": "zRE3e44PQVo",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Giải Đề PE Java Web: Nâng Cao Kỹ Năng Servlet và JSP",
            },
            {
                "willLearnId": 1,
                "willLearnContent": " Thực Hành Java Servlet và JSP: Giải Quyết Đề Thi PE",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Khóa Học Giải Đề PE: Phát Triển Ứng Dụng Web với Java Servlet và JSP",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Học Thực Hành Java Web: Giải Đề PE Servlet và JSP",
            }
        ],
        "courseLearned": false
    },
    {
        "courseIndex": 2,
        "courseName": "Build login google with Java | Jsp, Servlet",
        "courseImage": "./img/build_login_google.jpg",
        "courseType": "Analysis",
        "courseIntro": "https://www.youtube.com/embed/efI98nT8Ffo",
        "courseStudents": 500,
        "courseRate": 4.9,
        "coursePrice": 32.00,
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Build login google",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Build login google with Java | Jsp, Servlet",
                        "lengthVideo": 125.5,
                        "linkVideo": "https://www.youtube.com/watch?v=Esfv2KNzlRU&t=65s",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Cách tích hợp Google Sign-In vào ứng dụng Java sử dụng JSP và Servlet."
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Các khái niệm cơ bản về OAuth 2.0 và cách hoạt động của nó trong xác thực người dùng."
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Phương pháp xử lý yêu cầu và phản hồi từ Google API trong ứng dụng web."
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Cách xây dựng giao diện người dùng thân thiện cho chức năng đăng nhập Google."
            }
        ],
        "courseLearned": false
    },
    {
        "courseIndex": 3,
        "courseName": "Build login facebook",
        "courseImage": "./img/build_login_facebook.jpg",
        "courseType": "build business",
        "courseIntro": "https://www.youtube.com/embed/x0fSBAgBrOQ",
        "courseStudents": 642,
        "courseRate": 4.9,
        "coursePrice": "Free",
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Build login facebook by java | jsp servlet",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "ReactJS là gì? Tại sao nên học ReactJS?",
                        "lengthVideo": 10,
                        "linkVideo": "QUE-C6-yJJI",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Các mô hình, kiến trúc cơ bản khi triển khai ứng dụng",
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Các mô hình, kiến trúc cơ bản khi triển khai ứng dụng",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Các mô hình, kiến trúc cơ bản khi triển khai ứng dụng",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Các mô hình, kiến trúc cơ bản khi triển khai ứng dụng",
            }

        ],
        "courseLearned": false
    },
    {
        "courseIndex": 4,
        "courseName": "Export pdf by javascript",
        "courseImage": "./img/popular-course4.jpg",
        "courseType": "Web Design",
        "courseIntro": "https://www.youtube.com/watch?v=7jKzVRabKm4",
        "courseStudents": 143,
        "courseRate": 3.38,
        "coursePrice": "Free",
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "xport pdf by javascript with 10 line",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Mo hinh client - Sever la gi?",
                        "lengthVideo": 125.5,
                        "linkVideo": "https://www.youtube.com/watch?v=7jKzVRabKm4",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
    {
        "willLearnId": 0,
        "willLearnContent": "Hiểu hơn về cách internet và máy vi tính hoạt động."
    },
    {
        "willLearnId": 1,
        "willLearnContent": "Khám phá thư viện jsPDF và cách sử dụng nó để xuất PDF."
    },
    {
        "willLearnId": 2,
        "willLearnContent": "Thực hành viết mã JavaScript để tạo file PDF chỉ trong 10 dòng."
    },
    {
        "willLearnId": 3,
        "willLearnContent": "Nắm vững cách định dạng và tùy chỉnh nội dung trong PDF."
    }
],
        "courseLearned": false
    },
    {
        "courseIndex": 5,
        "courseName": "Tích hợp trình soạn thảo (tinymce)",
        "courseImage": "./img/tichhop_tinycme.webp",
        "courseType": "Java",
        "courseIntro": "https://www.youtube.com/watch?v=QWyabAkUuuk&t=5s",
        "courseStudents": 236,
        "courseRate": 4.5,
        "coursePrice": 'Free',
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Tích hợp trình soạn thảo (tinymce) | add text editor in jsp, servlet",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Mo hinh client - Sever la gi?",
                        "lengthVideo": 9.04,
                        "linkVideo": "https://www.youtube.com/embed/zoELAirXMJY",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            }

        ],
        "courseLearned": false
    },
    {
        "courseIndex": 6,
        "courseName": "Export excel by java",
        "courseImage": "./img/build_export_excel.jpg",
        "courseType": "Artificial Intelligence",
        "courseIntro": "https://www.youtube.com/watch?v=FUaGJTOCBtU",
        "courseStudents": 360,
        "courseRate": 4.9,
        "coursePrice": "Free",
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Export excel by java | java servlet | sql server",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Mo hinh client - Sever la gi?",
                        "lengthVideo": 23.33,
                        "linkVideo": "https://www.youtube.com/watch?v=FUaGJTOCBtU",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Biết thêm một số kỹ thuật với Javascript",
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Biết thêm một số kỹ thuật với Javascript",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Biết thêm một số kỹ thuật với Javascript",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Biết thêm một số kỹ thuật với Javascript",
            }
        ],
        "courseLearned": false
    },
    {
        "courseIndex": 7,
        "courseName": "Hướng dẫn send email trong java",
        "courseImage": "./img/swp_send_mail.jpg",
        "courseType": "Web Design",
        "courseIntro": "https://www.youtube.com/watch?v=wkNwSV7ajzI&t=1364s",
        "courseStudents": 949,
        "courseRate": 5,
        "coursePrice": 'Free',
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Hướng dẫn send email trong java servlet | forget password",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Mo hinh client - Sever la gi?",
                        "lengthVideo": 59.16,
                        "linkVideo": "https://www.youtube.com/watch?v=wkNwSV7ajzI&t=1364s",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            }

        ],
        "courseLearned": false
    },
    {
        "courseIndex": 8,
        "courseName": "Wed201c - PE",
        "courseImage": "./img/popular-course2.jpg",
        "courseType": "Web Design",
        "courseIntro": "https://www.youtube.com/watch?v=qFAH1-4Gvg0&t=84s",
        "courseStudents": 1.044,
        "courseRate": 4.9,
        "coursePrice": 'free',
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Khai niem ky thuat can biet",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Giải đề PE WED201c | Spring2023",
                        "lengthVideo": 63,
                        "linkVideo": "https://www.youtube.com/watch?v=qFAH1-4Gvg0&t=84s",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            }

        ],
        "courseLearned": false
    },
    {
        "courseIndex": 9,
        "courseName": "Prn211 & Prn212 Cách cấu hình để thi PE",
        "courseImage": "./img/popular-course2.jpg",
        "courseType": "Web Design",
        "courseIntro": "https://www.youtube.com/watch?v=aUpOYI3ArTE&t=82s",
        "courseStudents": 1.178,
        "courseRate": 4.9,
        "coursePrice": 37.80,
        "courseVideo": [
            {
                "chapterIndex": 0,
                "chapterTitle": "Prn211 Cách cấu hình để thi PE",
                "chapterVideo": [
                    {
                        "indexVideo": 0,
                        "nameVideo": "Prn212 Cách cấu hình để thi PE, câu 1 Winform | Spring 2024 | .NET Entity framework",
                        "lengthVideo": 66,
                        "linkVideo": "https://www.youtube.com/watch?v=aUpOYI3ArTE&t=82s",
                        "learnedVideo": false,
                        "learnedLength": -1
                    }
                ]
            }
        ],
        "courseWillLearn": [
            {
                "willLearnId": 0,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 1,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 2,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            },
            {
                "willLearnId": 3,
                "willLearnContent": "Các kiến thức cơ bản, nền móng của ngành IT",
            }

        ],
        "courseLearned": false
    }
]
const urlParams = window.location.href;
const urlParamsArr = urlParams.split('=')
const courseIndex = parseInt(urlParamsArr[urlParamsArr.length - 1]);

let linkPrevPage = document.querySelector('.prev_page-btn')
linkPrevPage.href = `https://cuongtran6969.github.io/TVCsellCourse/course.html?courseIndex=` + encodeURIComponent(courseIndex + 1)


console.log(courseIndex);
let headerTitle = document.querySelector('.header__course-title')

headerTitle.innerHTML = popularCourses[courseIndex].courseName
var videoLink = popularCourses[courseIndex].courseVideo[0].chapterVideo[0].linkVideo

function displayListVideo() {
    let learningList = document.querySelector('.learning__list')
    let html = ``
    let indexChapter = 1;
    let indexVideo = 1;
    const listChapter = popularCourses[courseIndex].courseVideo
    listChapter.forEach((chapter) => {
        html +=
            `
        <li class="learning__item">
        <div class="learning__chapter-panel learning__chapter-${indexChapter}">
            <h2 class="learning__chapter-name">${indexChapter}. ${chapter.chapterTitle}</h2>
            <span class="learning__chapter-progress">${getChapterProgress(chapter.chapterVideo)}</span>
        </div>
        <div class="learning__chapter-collapse">
            ${getCurrentListVideo(chapter, chapter.chapterVideo)}
        </div>
    </li>
        `
        indexChapter++
    })
    function getCurrentListVideo(currChapter, currvideo) {
        let text = ``
        currvideo.forEach((video) => {
            text += `
            <div class="learning__lesson-item video-index-${currChapter.chapterIndex}-${video.indexVideo}">
                <h5 class="learning__lesson-item-name">${indexVideo}. ${video.nameVideo}</h5>
                <p class="learning__lesson-item-time">${getVideoLength(video.lengthVideo)}</p>
            </div>
            `
            indexVideo++;
        })
        return text
    }
    learningList.innerHTML = html
}
displayListVideo()
//list video
let listVideo = document.querySelectorAll('.learning__lesson-item')
// listVideo[listVideo.length-1].style.marginBottom = '5rem'
let headerProgress = document.querySelector('.header__learning-progress-lesson')
headerProgress.innerHTML = `0/${listVideo.length} bài học`

function getVideoLength(time) {
    let hours = parseInt(time / 60);
    let minutes = parseInt(time - (hours * 60));
    let second = ((time - (hours * 60) - minutes));
    while (Number.isInteger(second) !== true) {
        second = second.toFixed(2) * 10
    }
    if (minutes < 10) {
        minutes = `0${minutes}`
    }
    if (second > 1 && second < 10) {
        second = `0${second}`
    }
    if (hours == 0) {
        return `${minutes}:${second}`
    } else {
        return `${hours}:${minutes}:${second}`
    }
}

function showListVideo() {
    let listChapter = document.querySelectorAll('.learning__item')
    listChapter.forEach((chapterItem) => {
        chapterItem.addEventListener('click', () => {
            chapterItem.classList.toggle('showListLesson')
        })
        let listVideoofChapter = chapterItem.querySelector('.learning__chapter-collapse')
        listVideoofChapter.addEventListener('click', (e) => {
            e.stopPropagation()
        })
    })
}
showListVideo()

function getChapterProgress(chapter) {
    let chapterLength = chapter.length;
    //recive the number of lesson suitable condition 
    let videoLearned = getVideoLearnedChapter(chapter);
    let chapterTime = 0;
    //get total time of all video in chapter
    for (let i = 0; i < chapter.length; i++) {
        chapterTime += chapter[i].lengthVideo
    }
    //covert number of chapterTime to string hour:minutes:seconds
    chapterTime = getVideoLength(chapterTime);
    return `${videoLearned}/${chapterLength} | ${chapterTime}`
}
function getVideoLearnedChapter(currChapter) {
    let videoDone = 0;
    for (let i = 0; i < currChapter.length; i++) {
        if (currChapter[i].learnedVideo === true) {
            videoDone++
        }
    }
    return videoDone
}
var currentIndexVideo = 0;
var videoLength = 0;
const prevLessonBtn = document.querySelector('.learning__lesson-prev')
const nextLessonBtn = document.querySelector('.learning__lesson-next')

//add class have been click "learning"
function handleLearnVideo() {
    let chapterIndex = 0;
    let videoIndex = 0;
    listVideo[0].classList.add('learning')
    let lessonTitle = document.querySelector('.leanring__video-name')
    let currentTitle = listVideo[0].querySelector('.learning__lesson-item-name').innerText
    let lessonNavAction = document.querySelector('.learning__lesson-name')
    lessonTitle.innerHTML = currentTitle.replace(/^\d+\.\s/, '')
    let learningChapterName;
    learningChapterName = document.querySelector('.learning__chapter-1')
    lessonNavAction.innerHTML = learningChapterName.querySelector('.learning__chapter-name').innerHTML
    // learningLessonName.innerHTML = currentTitle
    for (let i = 0; i < listVideo.length; i++) {
        listVideo[i].addEventListener('click', () => {
            // renderProgressCourse()
            currentTitle = listVideo[i].querySelector('.learning__lesson-item-name').innerText
            //deleta before leaning
            for (let j = 0; j < listVideo.length; j++) {
                if (listVideo[j].classList.contains('learning') && j != i) {
                    listVideo[j].classList.remove('learning')
                }
            }

            //add learning to the item click
            listVideo[i].classList.add('learning')
            classNames = listVideo[i].className.split(' ');
            indexClass = classNames.find(className => className.startsWith('video-index-'));
            chapterIndex = indexClass.split('-')[2];
            videoIndex = indexClass.split('-')[3];
            let cuurChapterIndex = Number(chapterIndex) + 1;
            learningChapterName = document.querySelector(`.learning__chapter-${cuurChapterIndex}`)
            lessonNavAction.innerHTML = learningChapterName.querySelector('.learning__chapter-name').innerHTML
            getVideoOfLesson(chapterIndex, videoIndex, i)
            currentIndexVideo = i;
            checkLearnedVideo()
            lessonTitle.innerHTML = currentTitle.slice(currentTitle.indexOf('.') + 2);

        })
    }
}
handleLearnVideo()
//check next index can learn and check have learnedVideo === true then add learned
//called will check if first it will alway true and pass, second continue will alway !true is mean = fasle will not pass
let flatCalledNext = false
let flatPrevClick = false
let flatNextClick = false

function openNextVideo(index, timeWatched) {
    let classNames = listVideo[index].className.split(' ');
    let indexClass = classNames.find(className => className.startsWith('video-index-'));
    let chapterIndex = parseInt(indexClass.split('-')[2]);
    let videoIndex = indexClass.split('-')[3];
    let videoNow = popularCourses[courseIndex].courseVideo[chapterIndex].chapterVideo[videoIndex]

    // if(nextLessonBtn.classList.contains('actionActive')) {
    //     nextLessonBtn.classList.remove('actionActive')
    // }
    if (index > 0 && !prevLessonBtn.classList.contains('actionActive')) {
        prevLessonBtn.classList.add('actionActive')
    }
    if (index === 0) {
        prevLessonBtn.classList.remove('actionActive')
    }
    if (index === listVideo.length - 1) {
        nextLessonBtn.classList.remove('actionActive')
    }

    prevLessonBtn.addEventListener('click', () => {
        if (index > 0) {
            listVideo[index - 1].click()
        }
    })
    //asign current time watching to learnedLength (last length watching) it mean is big than before
    if (timeWatched > videoNow.learnedLength) {
        videoNow.learnedLength = timeWatched
    }
    if (index < listVideo.length - 1) {
        //if next item don't have canLearn and nextBtn hava active => remove actionActive of nextBtn
        if (!listVideo[index + 1].classList.contains('canLearn') && nextLessonBtn.classList.contains('actionActive'))
            nextLessonBtn.classList.remove('actionActive')

        if (listVideo[index + 1].classList.contains('canLearn') && !flatNextClick) {
            nextLessonBtn.classList.add('actionActive')
            flatNextClick = true;
        }
    }
    //have canLearn

    let watchedLength = videoNow.learnedLength;
    let currentVideoLength = videoNow.lengthVideo
    //calculate percent watched video of length video
    let percentWatched = (watchedLength / (currentVideoLength * 60)) * 100
    if (index < listVideo.length && percentWatched.toFixed(2) > 60 && !flatCalledNext) {
        videoNow.learnedVideo = true;
        let currenLesson = document.querySelector(`.learning__chapter-${chapterIndex + 1}`)
        let chapterProgress = currenLesson.querySelector('.learning__chapter-progress')
        chapterProgress.innerHTML = getChapterProgress(popularCourses[courseIndex].courseVideo[chapterIndex].chapterVideo)
        accessLeaning(index)
        flatCalledNext = true
    }
}
//check learned, canlearn base learnedLength of video
function checkLearnedVideo() {
    for (let i = 0; i < listVideo.length; i++) {
        let classNames = listVideo[i].className.split(' ');
        let indexClass = classNames.find(className => className.startsWith('video-index-'));
        let chapterIndex = indexClass.split('-')[2];
        let videoIndex = indexClass.split('-')[3];
        if (popularCourses[courseIndex].courseVideo[chapterIndex].chapterVideo[videoIndex].learnedLength > 15) {
            listVideo[i].classList.add('learned')
            listVideo[i].classList.remove('canlearn')
        } else if (popularCourses[courseIndex].courseVideo[chapterIndex].chapterVideo[videoIndex].learnedLength > 0 && popularCourses[courseIndex].courseVideo[chapterIndex].chapterVideo[videoIndex].learnedLength < 15) {
            listVideo[i].classList.add('canlearn')
        }
    }
}
const learnedLesson = [];
function accessLeaning(index) {
    if (index < listVideo.length - 1) {
        listVideo[index + 1].classList.add('canLearn')
        nextLessonBtn.classList.add('actionActive')
    }

    nextLessonBtn.addEventListener('click', () => {
        listVideo[index + 1].click()
    })

    listVideo[index].classList.add('learned')
    let flat = 0;
    for (let i = 0; i < learnedLesson.length; i++) {
        if (learnedLesson[i] == index) {
            flat++;
        }
    }
    if (flat == 0) {
        learnedLesson.push(index)
        console.log(learnedLesson);
        renderProgressCourse();
    }
    let learnedLessons = 0;
    listVideo.forEach((video) => {
        if (video.classList.contains('learned')) {
            learnedLessons++
        }
    })
    let headerProgress = document.querySelector('.header__learning-progress-lesson')
    headerProgress.innerHTML = `${learnedLessons}/${listVideo.length} bài học`
}
var player
//check action change of video
function getVideoOfLesson(chapterIndex, videoIndex, index) {
    var tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName("script")[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    currentIndexVideo = index;
    videoLink = popularCourses[courseIndex].courseVideo[chapterIndex].chapterVideo[videoIndex].linkVideo
    flatCalledNext = false
    flatNextClick = false
    player.loadVideoById(videoLink);
}

function renderProgressCourse() {
    let circularProgress = document.querySelector('.circular-progress')
    let percentValue = document.querySelector('.progress-value')
    let percentOfAllLesson = 0;
    // let lessonLearned = 0;
    let percentCircle = 0;
    let totalTimeCourse = getTotallLength()
    let listChapter = popularCourses[courseIndex].courseVideo
    listChapter.forEach((chapter) => {
        for (let i = 0; i < chapter.chapterVideo.length; i++) {
            if (chapter.chapterVideo[i].learnedVideo === true) {
                percentOfAllLesson += ((chapter.chapterVideo[i].lengthVideo) / totalTimeCourse * 100)
                percentCircle += ((chapter.chapterVideo[i].lengthVideo) / totalTimeCourse * 360)
            }
        }
    })
    percentCircle = Math.round(percentCircle)
    percentOfAllLesson = Math.round(percentOfAllLesson)
    circularProgress.style.background = `conic-gradient(red ${percentCircle}deg, #4d4f50 0deg)`
    percentValue.innerHTML = `${percentOfAllLesson}%`
}
renderProgressCourse()
function getTotallLength() {
    let courseTime = 0;
    let chapterList = popularCourses[courseIndex].courseVideo
    chapterList.forEach((chapter) => {
        for (let i = 0; i < chapter.chapterVideo.length; i++) {
            courseTime += chapter.chapterVideo[i].lengthVideo
        }
    })
    return courseTime;

}
function getWidthScreenScroll() {
    let learningVideoBox = document.querySelector('.learning__video-box')
    let iframeVideo = document.getElementById('learning__video-now')
    window.addEventListener('resize', () => {
        console.log(iframeVideo.Height);
    })
}
getWidthScreenScroll()

//handle close open nav
function handleLessonAction() {
    let lessonNav = document.querySelector('.learning__lesson-nav')
    let learningNav = document.querySelector('.learning__video-nav')
    let learningContent = document.querySelector('.learning__video-content')
    let closeNavBtn = document.querySelector('.close__nav-btn')
    let overlayScreen = document.querySelector('.overlay-screen')
    closeNavBtn.addEventListener('click', () => {
        learningNav.classList.toggle('showNav')
        overlayScreen.classList.toggle('showOverlay')
        learningContent.classList.toggle('maxWidth')
    })
    overlayScreen.addEventListener('click', () => {
        learningNav.classList.toggle('showNav')
        overlayScreen.classList.toggle('showOverlay')
        learningContent.classList.toggle('maxWidth')
    })
    lessonNav.addEventListener('click', () => {
        learningNav.classList.toggle('showNav')
        learningContent.classList.toggle('maxWidth')
        lessonNav.classList.toggle('hasClick')
        overlayScreen.classList.toggle('showOverlay')
    })
}
handleLessonAction()
function onYouTubeIframeAPIReady() {
    player = new YT.Player("learning__video-now", {
        height: "390",
        width: "640",
        videoId: `${videoLink}`
    });

    var iframeWindow = player.getIframe().contentWindow;
    var lastTimeUpdate = 0;
    window.addEventListener("message", function (event) {
        if (event.source === iframeWindow) {
            var data = JSON.parse(event.data);
            if (
                data.event === "infoDelivery" &&
                data.info &&
                data.info.currentTime
            ) {
                var time = Math.floor(data.info.currentTime);
                if (time !== lastTimeUpdate) {
                    lastTimeUpdate = time;
                    //lay index video hien tai truyen vao
                    openNextVideo(currentIndexVideo, time)
                }
            }
        }
    });
}

getVideoOfLesson(0, 0, 0)



